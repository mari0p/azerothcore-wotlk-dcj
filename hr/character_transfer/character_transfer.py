# -*- coding: utf-8 -*-
"""WOTLK Character Dump.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1miNhdd4_Y4HA9t5usm9KlO7SSTGZzkN2
"""

from google.colab import auth
import gspread
from google.auth import default
#autenticating to google
auth.authenticate_user()
creds, _ = default()
gc = gspread.authorize(creds)

import base64
import json
import time
import pandas as pd
import re
#defining my worksheet
workbook = gc.open('WOTLK HR (DCj Opt)')
worksheet = workbook.worksheet('PTR-CharacterDumps')
#get_all_values gives a list of rows
rows = worksheet.get_all_values()
#Convert to a DataFrame 
df = pd.DataFrame(rows)
#creating columns name
df.columns = df.iloc[0]
df = df.iloc[1:]

dumps = {}
for i in range(len(df['PTR Character Name'])):
  char_name = df['PTR Character Name'].iloc[i]
  raw_str = df['Contents of WTF/Account/<youraccountname>/SavedVariables/chardump.lua'].iloc[i]
  dump_data = re.search('CHDMP_DATA = "(.+?)"', raw_str)
  if dump_data:
    dumps[char_name] = "==" + dump_data.group(1)



def GetEquipmentCache(char_inv):
  eqcache = ""
  for i in range(1,24):
    bagkey = "0000:{equip_slot}".format(equip_slot=i)
    if bagkey in char_inv.keys():
      slot = char_inv[bagkey] 
      for slot_key in ["I","E"]:# only needs item id and enchant for equipment cache,"G1","G2","G3"]:
        if slot_key in slot.keys() and slot[slot_key] != "":
          eqcache += slot[slot_key] + " "
        else:
          eqcache += "0 "
    else:
      eqcache += "0 0 "

  return eqcache

def GetEnchantments(item):
  # {'I': '40562', 'C': 1, 'G2': '39998', 'E': '3820', 'G3': '', 'G1': '41285'}
  # {'I': '44661', 'C': 1, 'G2': '', 'E': '', 'G3': '', 'G1': '40026'}
  # {'I': '40424', 'C': 1, 'G2': '', 'E': '3810', 'G3': '', 'G1': '39998'}
  # {'I': '859', 'C': 1, 'G2': '', 'E': '', 'G3': '', 'G1': ''}
  # {'I': '40423', 'C': 1, 'G2': '40051', 'E': '1144', 'G3': '', 'G1': '39998'}
  # {'I': '40696', 'C': 1, 'G2': '39998', 'E': '', 'G3': '', 'G1': '40049'}
  # {'I': '40422', 'C': 1, 'G2': '40051', 'E': '3872', 'G3': '', 'G1': '39998'}
  # {'I': '40750', 'C': 1, 'G2': '', 'E': '3606', 'G3': '', 'G1': ''}
  # {'I': '39252', 'C': 1, 'G2': '', 'E': '2332', 'G3': '', 'G1': ''}
  # {'I': '40420', 'C': 1, 'G2': '', 'E': '3604', 'G3': '', 'G1': '39998'}
  # {'I': '40080', 'C': 1, 'G2': '', 'E': '', 'G3': '', 'G1': ''}
  # {'I': '40719', 'C': 1, 'G2': '', 'E': '', 'G3': '', 'G1': ''}
  # {'I': '40255', 'C': 1, 'G2': '', 'E': '', 'G3': '', 'G1': ''}
  # {'I': '40682', 'C': 1, 'G2': '', 'E': '', 'G3': '', 'G1': ''}
  # {'I': '44005', 'C': 1, 'G2': '', 'E': '3722', 'G3': '', 'G1': '40026'}
  # {'I': '40396', 'C': 1, 'G2': '', 'E': '3834', 'G3': '', 'G1': ''}
  # {'I': '40273', 'C': 1, 'G2': '', 'E': '', 'G3': '', 'G1': ''}
  fields = ["PERM_ENCHANTMENT_SLOT", "TEMP_ENCHANTMENT_SLOT", "SOCK_ENCHANTMENT_SLOT", 
            "SOCK_ENCHANTMENT_SLOT_2", "SOCK_ENCHANTMENT_SLOT_3", "BONUS_ENCHANTMENT_SLOT", 
            "PRISMATIC_ENCHANTMENT_SLOT", "PROP_ENCHANTMENT_SLOT_0", "PROP_ENCHANTMENT_SLOT_1", 
            "PROP_ENCHANTMENT_SLOT_2", "PROP_ENCHANTMENT_SLOT_3"	, "PROP_ENCHANTMENT_SLOT_4"]
  
  chants = {}
  #syntax: id,duration,charges
  enchant = item["E"]
  if enchant == "" :
    enchant = 0

  chants["PERM_ENCHANTMENT_SLOT"] = [enchant, 0, 0 ]
  chants["SOCK_ENCHANTMENT_SLOT"] = [gem2id[item["G1"]], 0, 0 ]
  chants["SOCK_ENCHANTMENT_SLOT_2"] = [gem2id[item["G2"]], 0, 0 ]
  chants["SOCK_ENCHANTMENT_SLOT_3"] = [gem2id[item["G3"]], 0, 0 ]

  result_str = ""
  for field in fields:
    if field in chants.keys():
      result_str += "{id} {duration} {charges} ".format(
          id=chants[field][0],
          duration=0,
          charges=0
      )
    else:
      result_str += "0 0 0 "

  #print(result_str)
  return result_str

def GetRaceID(race):
  if race.upper()=="HUMAN":
    return 1
  if race.upper()=="ORC":
    return 2
  if race.upper()=="DWARF":
    return 3
  if race.upper()=="NIGHTELF":
    return 4
  if race.upper()=="SCOURGE":
    return 5 #instead undead
  if race.upper()=="TAUREN":
    return 6
  if race.upper()=="GNOME":
    return 7
  if race.upper()=="TROLL":
    return 8
  if race.upper()=="BLOODELF":
    return 10
  if race.upper()=="DRAENEI":
    return 11

def GetClassID(pclass):
  if pclass=="WARRIOR":
    return 1
  if pclass=="PALADIN":
    return 2
  if pclass=="HUNTER":
    return 3
  if pclass=="ROGUE":
    return 4
  if pclass=="PRIEST":
    return 5
  if pclass=="DEATHKNIGHT":
    return 6
  if pclass=="SHAMAN":
    return 7
  if pclass=="MAGE":
    return 8
  if pclass=="WARLOCK":
    return 9
  if pclass=="DRUID":
    return 11

gem2id = {
  "":0,"32199":3121,"31866":3110,"28469":2967,"28464":2962,"28461":2959,"28290":2942,"23119":2699,"23116":2697,"23103":2762,"23100":2755,"23098":2752,"23094":2690,"23099":2705,"23109":2709,"23121":2701,"23104":2757,"27809":2921,"27812":2924,"27820":2923,"28361":2944,"28463":2961,"28467":2965,"28470":2968,"28465":2963,"28466":2964,"28460":2958,"28462":2960,"28468":2966,"28458":2956,"28459":2957,"23095":2691,"23096":2692,"23105":2706,"23108":2708,"23111":2711,"23113":2694,"23118":2698,"23120":2700,"24027":2725,"24066":2763,"28595":2971,"25890":2827,"25893":2828,"25894":2829,"25895":2830,"25898":2833,"25899":2834,"25901":2835,"27679":2891,"27777":2896,"27785":2898,"27786":2899,"28118":2912,"28119":2913,"28120":2914,"28123":2916,"28360":2943,"28362":2945,"28363":2946,"28556":2969,"28557":2970,"30555":3054,"30556":3055,"30558":3056,"30559":3057,"30563":3060,"30571":3065,"30587":3075,"30589":3077,"30591":3079,"30592":3080,"30598":3103,"22459":2948,"22460":2947,"23097":2693,"23101":2760,"23106":2707,"23110":2710,"23114":2695,"23115":2696,"24058":2753,"24048":2735,"24029":2727,"30604":3087,"24062":2743,"24060":2742,"24065":2744,"24047":2734,"24067":2758,"24057":2741,"24054":2738,"24052":2737,"24037":2733,"24036":2754,"24033":2731,"24030":2728,"24028":2726,"30605":3088,"30594":3082,"30564":3061,"24050":2736,"24035":2732,"24031":2729,"24061":2756,"24059":2761,"24056":2740,"24055":2739,"24032":2730,"25896":2831,"24039":2765,"24051":2764,"25897":2832,"30546":3045,"30547":3046,"30548":3047,"30549":3048,"30550":3049,"30551":3050,"30552":3051,"30553":3052,"30554":3053,"30560":3058,"30565":3062,"30566":3063,"30572":3064,"30573":3066,"30574":3067,"30575":3068,"30581":3069,"30582":3070,"30583":3071,"30584":3072,"30585":3073,"30586":3074,"30588":3076,"30590":3078,"30593":3081,"30600":3083,"30601":3084,"30602":3085,"30603":3086,"30606":3089,"30607":3090,"30608":3091,"31116":3099,"31117":3100,"31118":3101,"32735":3197,"31869":3113,"24053":2759,"32836":3202,"32195":3117,"32216":3138,"32204":3126,"32202":3124,"32196":3118,"32223":3145,"31860":3104,"31861":3105,"31862":3106,"31863":3107,"31864":3108,"31865":3109,"31867":3111,"31868":3112,"32193":3115,"32194":3116,"32197":3119,"32198":3120,"32200":3122,"32201":3123,"32203":3125,"32205":3127,"32206":3128,"32207":3129,"32208":3130,"32209":3131,"32210":3132,"32211":3133,"32212":3134,"32213":3135,"32214":3136,"32215":3137,"32218":3140,"32219":3141,"32220":3142,"32222":3144,"32224":3146,"32225":3147,"32226":3148,"32409":3154,"32410":3155,"32634":3156,"32635":3157,"32636":3158,"32637":3159,"32638":3160,"32639":3161,"32640":3162,"32641":3163,"32833":3201,"32217":3139,"32221":3143,"33060":3206,"33131":3208,"33132":3209,"33133":3210,"33134":3211,"33135":3212,"33137":3214,"33138":3215,"33139":3216,"33140":3217,"33141":3218,"33142":3219,"33143":3220,"33144":3221,"33782":3226,"34220":3261,"34256":3262,"35761":3287,"35760":3286,"35759":3285,"35758":3284,"35707":3280,"35503":3275,"35501":3274,"35489":3283,"35488":3282,"35487":3281,"34831":3268,"35316":3271,"35315":3270,"35318":3272,"37503":3318,"38545":3335,"38546":3336,"38547":3337,"38548":3338,"38549":3339,"38550":3340,"34142":3242,"34143":3254,"34627":3264,"36766":3292,"36767":3293,"37430":3317,"38292":3321,"38498":3333,"38538":3334,"39900":3371,"39905":3374,"39906":3375,"39907":3376,"39908":3377,"39909":3378,"39910":3379,"39911":3380,"39912":3381,"39914":3382,"39915":3383,"39916":3384,"39917":3385,"39918":3386,"39919":3387,"39920":3388,"39927":3389,"39932":3390,"39933":3391,"39934":3392,"39935":3393,"39936":3394,"39937":3395,"39938":3396,"39939":3397,"39940":3398,"39941":3399,"39942":3400,"39943":3401,"39944":3402,"39945":3403,"39946":3404,"39947":3405,"39948":3411,"39949":3407,"39950":3408,"39951":3409,"39952":3410,"39953":3406,"39954":3412,"39955":3413,"39956":3414,"39957":3415,"39958":3416,"39959":3417,"39960":3422,"39961":3423,"39962":3424,"39963":3426,"39964":3418,"39965":3419,"39966":3420,"39967":3421,"39968":3427,"39974":3428,"39975":3429,"39976":3430,"39977":3431,"39978":3432,"39979":3433,"39980":3434,"39981":3435,"39982":3436,"39983":3437,"39984":3438,"39985":3439,"39986":3440,"39988":3441,"39989":3442,"39990":3443,"39991":3444,"39992":3445,"39996":3446,"39997":3447,"39998":3448,"39999":3449,"40000":3450,"40001":3451,"40002":3452,"40003":3453,"40008":3454,"40009":3455,"40010":3456,"40011":3457,"40012":3458,"40013":3459,"40014":3460,"40015":3461,"40016":3462,"40017":3463,"40022":3464,"40023":3465,"40024":3474,"40025":3466,"40026":3472,"40027":3473,"40028":3476,"40029":3467,"40030":3475,"40031":3468,"40032":3469,"40033":3470,"40034":3471,"40037":3477,"40038":3478,"40039":3479,"40040":3480,"40041":3481,"40043":3482,"40044":3483,"40045":3484,"40046":3485,"40047":3486,"40048":3487,"40049":3488,"40050":3489,"40051":3490,"40052":3491,"40053":3492,"40054":3493,"40055":3494,"40056":3495,"40057":3496,"40058":3497,"40059":3498,"40085":3499,"40086":3500,"40088":3501,"40089":3502,"40090":3503,"40091":3504,"40092":3505,"40094":3510,"40095":3506,"40096":3511,"40098":3515,"40099":3507,"40100":3512,"40101":3516,"40102":3508,"40103":3513,"40104":3509,"40105":3514,"40106":3517,"40111":3518,"40112":3519,"40113":3520,"40114":3521,"40115":3522,"40116":3523,"40117":3525,"40118":3524,"40119":3532,"40120":3533,"40121":3534,"40122":3535,"40123":3526,"40124":3527,"40125":3528,"40126":3529,"40127":3530,"40128":3531,"40129":3536,"40130":3537,"40131":3544,"40132":3538,"40133":3545,"40134":3546,"40135":3548,"40136":3539,"40137":3547,"40138":3540,"40139":3541,"40140":3543,"40141":3542,"40142":3549,"40143":3550,"40144":3551,"40145":3552,"40146":3553,"40147":3554,"40148":3555,"40149":3556,"40150":3557,"40151":3558,"40152":3559,"40153":3560,"40154":3561,"40155":3563,"40156":3564,"40157":3565,"40158":3566,"40159":3567,"40160":3568,"40161":3569,"40162":3570,"40163":3571,"40164":3572,"40165":3573,"40166":3574,"40167":3575,"40168":3576,"40169":3577,"40170":3578,"40171":3579,"40172":3580,"40173":3581,"40174":3582,"40175":3583,"40176":3584,"40177":3585,"40178":3586,"40179":3587,"40180":3588,"40181":3589,"40182":3590,"40232":3591,"41285":3621,"41307":3622,"41333":3623,"41335":3624,"41339":3625,"41375":3632,"41376":3633,"41377":3634,"41378":3635,"41379":3636,"41380":3637,"41381":3638,"41382":3639,"41385":3640,"41389":3641,"41395":3626,"41396":3631,"41397":3642,"41398":3628,"41400":3643,"41401":3627,"41429":3767,"41432":3649,"41433":3651,"41434":3644,"41435":3648,"41436":3652,"41437":3647,"41438":3650,"41439":3646,"41440":3654,"41441":3655,"41442":3653,"41443":3656,"41444":3661,"41445":3662,"41446":3659,"41447":3660,"41448":3657,"41449":3658,"41450":3664,"41451":3670,"41452":3675,"41453":3669,"41454":3663,"41455":3674,"41456":3665,"41457":3673,"41458":3668,"41459":3672,"41460":3667,"41461":3671,"41462":3666,"41463":3711,"41464":3700,"41465":3714,"41466":3702,"41467":3701,"41468":3699,"41469":3712,"41470":3698,"41471":3713,"41472":3709,"41473":3705,"41474":3716,"41475":3703,"41476":3708,"41477":3710,"41478":3715,"41479":3706,"41480":3707,"41481":3704,"41482":3696,"41483":3683,"41484":3686,"41485":3677,"41486":3692,"41487":3680,"41488":3682,"41489":3685,"41490":3695,"41491":3687,"41492":3681,"41493":3688,"41494":3689,"41495":3690,"41496":3679,"41497":3693,"41498":3697,"41499":3684,"41500":3694,"41501":3678,"41502":3691,"42142":3732,"42143":3733,"42144":3734,"42145":3735,"42146":3736,"42148":3737,"42149":3738,"42150":3739,"42151":3740,"42152":3741,"42153":3745,"42154":3746,"42155":3747,"42156":3742,"42157":3743,"42158":3744,"42701":3749,"42702":3750,"44066":3792,"44076":3798,"44078":3799,"44081":3801,"44082":3800,"44084":3802,"44087":3803,"44088":3804,"44089":3805,"45862":3861,"45879":3862,"45880":3863,"45881":3864,"45882":3865,"45883":3866,"45987":3867,"49110":3879
}

glyph2id = {
   "-1":0, "":0, "52084":2, "12320":21, "12297":22, "46831":61, "52084":81, "52085":82, "46487":121, "54292":141, "54810":161, "54811":162, "54812":163, "54813":164, "54815":165, "54818":166, "54821":167, "54824":168, "54832":169, "54733":170, "54743":171, "54754":172, "54825":173, "54826":174, "54845":175, "54830":176, "54831":177, "54828":178, "54756":179, "54829":180, "54760":181, "54912":182, "54922":183, "54925":184, "54923":185, "54924":186, "54926":187, "54927":188, "54928":189, "54929":190, "54930":191, "54931":192, "54934":193, "54935":194, "54936":195, "54937":196, "54938":197, "54939":198, "54940":199, "54943":200, "55436":211, "55437":212, "55449":213, "55454":214, "55442":215, "55439":216, "55455":217, "55450":218, "55447":219, "55451":220, "55443":221, "55456":222, "55440":223, "55438":224, "55448":225, "55453":226, "55441":227, "55446":228, "55444":229, "55452":230, "55445":231, "55675":251, "55677":252, "55684":253, "55678":254, "55679":255, "55683":256, "55686":257, "55673":258, "55691":259, "55688":260, "55681":261, "55689":262, "55672":263, "55680":264, "55676":265, "55674":266, "55690":267, "55682":268, "55687":269, "55692":270, "55685":271, "56242":272, "56235":273, "56218":274, "56241":275, "56232":276, "56244":277, "56246":278, "56249":279, "56238":280, "56224":281, "56217":282, "56228":283, "56248":284, "56226":285, "56240":286, "56229":287, "56216":288, "56231":289, "56250":290, "56233":291, "56247":292, "56360":311, "56363":312, "56381":313, "56365":314, "56380":315, "56368":316, "56369":317, "56376":318, "56370":319, "56384":320, "56372":321, "56377":322, "56374":323, "56371":324, "56366":325, "56383":326, "56367":327, "56382":328, "56375":329, "56364":330, "56373":331, "56824":351, "56841":352, "56857":353, "56833":354, "56851":355, "56830":356, "56850":357, "56844":358, "56845":359, "56847":360, "56829":361, "56846":362, "56856":363, "56836":364, "56828":365, "56832":366, "56849":367, "56826":368, "56842":369, "56838":370, "56848":371, "56808":391, "56813":392, "56800":393, "56818":394, "56820":395, "56806":396, "56799":397, "56802":398, "56803":399, "56804":400, "56812":401, "56814":402, "56809":403, "56807":404, "56819":405, "56801":406, "56798":407, "56805":408, "56821":409, "56810":410, "56811":411, "57856":431, "57858":432, "57855":433, "57857":434, "57862":435, "58133":436, "58132":438, "57866":439, "57870":440, "57903":441, "57902":442, "57904":443, "57900":444, "57924":445, "57926":446, "57927":447, "57928":448, "58136":449, "52648":450, "57925":451, "57937":452, "57958":453, "57979":454, "57955":455, "57947":456, "57954":457, "57985":458, "57987":459, "58009":460, "57986":461, "58015":462, "58228":463, "58032":464, "58027":465, "58017":466, "58033":467, "58039":468, "58038":469, "58058":470, "58135":471, "58134":472, "58059":473, "58055":474, "58063":475, "58057":476, "58079":477, "58070":478, "58081":479, "58080":480, "58107":481, "58094":482, "58095":483, "58096":484, "58097":485, "58099":486, "58098":487, "58104":488, "58368":489, "58369":490, "58355":491, "58366":492, "58388":493, "58367":494, "58372":495, "58357":496, "58377":497, "58365":498, "58386":499, "58385":500, "58364":501, "58375":502, "58376":503, "58387":504, "58384":505, "58353":506, "58356":507, "58382":508, "58370":509, "58613":511, "58623":512, "58616":513, "58640":514, "58673":515, "58620":516, "58677":518, "62259":519, "58629":520, "58647":521, "58680":522, "58625":523, "58631":524, "58671":525, "58657":526, "58686":527, "58669":528, "58642":529, "58618":530, "58635":531, "58676":532, "59219":551, "59289":552, "59309":553, "59307":554, "60200":555, "59327":556, "59332":557, "59336":558, "56420":559, "56414":560, "56416":561, "60200":571, "61205":591, "62126":611, "62132":612, "62135":613, "62080":631, "62210":651, "62969":671, "62970":672, "62971":673, "63055":674, "63056":675, "63057":676, "63065":677, "63066":691, "63067":692, "63068":693, "63069":694, "63086":695, "63090":696, "63091":697, "63092":698, "63093":699, "63095":700, "63218":701, "63219":702, "63220":703, "63222":704, "63223":705, "63224":706, "63225":707, "63229":708, "63231":709, "63235":710, "63237":711, "63246":712, "63248":713, "63249":714, "63252":715, "63253":716, "63254":731, "63256":732, "63268":733, "63269":734, "63270":735, "63271":736, "63273":737, "63279":751, "63280":752, "63291":753, "63298":754, "63302":755, "63303":756, "63304":757, "63309":758, "63310":759, "63320":760, "63312":761, "63324":762, "63325":763, "63326":764, "63327":765, "63328":766, "63329":767, "63330":768, "63331":769, "63332":770, "63333":771, "63334":772, "63335":773, "64199":791, "65243":811, "67598":831, "68164":851, "70937":871, "71013":891, "70947":911
}

skill2id = {
  "EPÉES": 43, "HACHES": 44, "ARCS": 45, "ARMES À FEU": 46, "MASSE": 54, "EPÉES À DEUX MAINS": 55, "DÉFENSE": 95, "SECOURISME": 129, "BÂTONS": 136, "MASSES À DEUX MAINS": 160, "MAINS NUES": 162, "FORGE": 164, "TRAVAIL DU CUIR": 165, "ALCHIMIE": 171, "HACHES À DEUX MAINS": 172, "DAGUES": 173, "ARMES DE JET": 176, "HERBORISTERIE": 182, "CUISINE": 185, "MINAGE": 186, "COUTURE": 197, "INGÉNIERIE": 202, "ARBALÈTES": 226, "BAGUETTES": 228, "ARMES D'HAST": 229, "ARMURE EN PLAQUES": 293, "ENCHANTEMENT": 333, "PÊCHE": 356, "DÉPEÇAGE": 393, "MAILLES": 413, "CUIR": 414, "TISSU": 415, "BOUCLIER": 433, "ARMES DE PUGILAT": 473, "CROCHETAGE": 633, "JOAILLERIE": 755, "CALLIGRAPHIE": 773, "RUNEFORGER": 776, "SCHWERTER": 43, "AXTE": 44, "BOGEN": 45, "SCHUSSWAFFEN": 46, "STREITKOLBEN": 54, "ZWEIHANDSCHWERTER": 55, "VERTEIDIGUNG": 95, "ERSTE HILFE": 129, "STABE": 136, "ZWEIHANDSTREITKOLBEN": 160, "UNBEWAFFNET": 162, "SCHMIEDEKUNST": 164, "LEDERVERARBEITUNG": 165, "ALCHEMIE": 171, "ZWEIHANDAXTE": 172, "DOLCHE": 173, "WURFWAFFEN": 176, "KRAUTERKUNDE": 182, "KOCHKUNST": 185, "BERGBAU": 186, "SCHNEIDEREI": 197, "INGENIEURSKUNST": 202, "ARMBRUSTE": 226, "ZAUBERSTABE": 228, "STANGENWAFFEN": 229, "PLATTENPANZER": 293, "VERZAUBERKUNST": 333, "ANGELN": 356, "KURSCHNEREI": 393, "SCHWERE RUSTUNG": 413, "LEDER": 414, "STOFF": 415, "SCHILD": 433, "FAUSTWAFFEN": 473, "SCHLOSSKNACKEN": 633, "JUWELENSCHLEIFEN": 755, "INSCHRIFTENKUNDE": 773, "RUNEN SCHMIEDEN": 776, "МЕЧИ": 43, "ТОПОРЫ": 44, "ЛУКИ": 45, "ОГНЕСТРЕЛЬНОЕ ОРУЖИЕ": 46, "ДРОБЯЩЕЕ ОРУЖИЕ": 54, "ДВУРУЧНЫЕ МЕЧИ": 55, "ЗАЩИТА": 95, "ПЕРВАЯ ПОМОЩЬ": 129, "ПОСОХИ": 136, "ДВУРУЧНОЕ ДРОБЯЩЕЕ ОРУЖИЕ": 160, "РУКОПАШНЫЙ БОЙ": 162, "КУЗНЕЧНОЕ ДЕЛО": 164, "КОЖЕВНИЧЕСТВО": 165, "АЛХИМИЯ": 171, "ДВУРУЧНЫЕ ТОПОРЫ": 172, "КИНЖАЛЫ": 173, "МЕТАТЕЛЬНОЕ ОРУЖИЕ": 176, "ТРАВНИЧЕСТВО": 182, "КУЛИНАРИЯ": 185, "ГОРНОЕ ДЕЛО": 186, "ПОРТНЯЖНОЕ ДЕЛО": 197, "ИНЖЕНЕРНОЕ ДЕЛО": 202, "АРБАЛЕТЫ": 226, "ЖЕЗЛЫ": 228, "ДРЕВКОВОЕ ОРУЖИЕ": 229, "ЛАТЫ": 293, "НАЛОЖЕНИЕ ЧАР": 333, "РЫБНАЯ ЛОВЛЯ": 356, "СНЯТИЕ ШКУР": 393, "КОЛЬЧУЖНЫЕ ДОСПЕХИ": 413, "КОЖАНЫЕ ДОСПЕХИ": 414, "ТКАНЕВЫЕ ДОСПЕХИ": 415, "ЩИТ": 433, "КИСТЕВОЕ ОРУЖИЕ": 473, "ВЗЛОМ": 633, "ЮВЕЛИРНОЕ ДЕЛО": 755, "НАЧЕРТАНИЕ": 773, "КОВКА РУН": 776, "ESPADAS": 43, "HACHAS": 44, "ARCOS": 45, "ARMAS DE FUEGO": 46, "MAZAS": 54, "ESPADAS DE DOS MANOS": 55, "DEFENSA": 95, "PRIMEROS AUXILIOS": 129, "BASTONES": 136, "MAZAS DE DOS MANOS": 160, "SIN ARMAS": 162, "HERRERÍA": 164, "PELETERÍA": 165, "ALQUIMIA": 171, "HACHAS DE DOS MANOS": 172, "DAGAS": 173, "ARMAS ARROJADIZAS": 176, "HERBORISTERÍA": 182, "COCINA": 185, "MINERÍA": 186, "SASTRERÍA": 197, "INGENIERÍA": 202, "BALLESTAS": 226, "VARITAS": 228, "ARMAS DE ASTA": 229, "MALLA DE PLACAS": 293, "ENCANTAMIENTO": 333, "PESCA": 356, "DESOLLAR": 393, "MALLA": 413, "CUERO": 414, "TELA": 415, "ESCUDO": 433, "ARMAS DE PUÑO": 473, "GANZÚA": 633, "JOYERÍA": 755, "INSCRIPCIÓN": 773, "FORJA DE RUNAS": 776, "SWORDS": 43, "AXES": 44, "BOWS": 45, "GUNS": 46, "MACES": 54, "TWO-HANDED SWORDS": 55, "DEFENSE": 95, "FIRST AID": 129, "STAVES": 136, "TWO-HANDED MACES": 160, "UNARMED": 162, "BLACKSMITHING": 164, "LEATHERWORKING": 165, "ALCHEMY": 171, "TWO-HANDED AXES": 172, "DAGGERS": 173, "THROWN": 176, "HERBALISM": 182, "COOKING": 185, "MINING": 186, "TAILORING": 197, "ENGINEERING": 202, "CROSSBOWS": 226, "WANDS": 228, "POLEARMS": 229, "PLATE MAIL": 293, "ENCHANTING": 333, "FISHING": 356, "SKINNING": 393, "MAIL": 413, "LEATHER": 414, "CLOTH": 415, "SHIELD": 433, "FIST WEAPONS": 473, "LOCKPICKING": 633, "JEWELCRAFTING": 755, "INSCRIPTION": 773, "RUNEFORGING": 776
}

reputation_flags = {
    "21":64, "46":4, "47":17, "54":17, "59":17, "67":14, "68":6, "69":17, "70":2, "72":17, "76":6, "81":6, "83":4, "86":4, "87":2, "92":2, "93":2, "169":12, "270":17, "289":4, "349":0, "369":64, "469":25, "470":64, "471":20, "509":17, "510":2, "529":0, "530":6, "549":4, "550":4, "551":4, "569":4, "570":4, "571":4, "574":4, "576":2, "577":64, "589":0, "609":0, "729":2, "730":17, "749":0, "809":17, "889":6, "890":17, "891":24, "892":14, "909":17, "910":2, "911":6, "922":6, "930":17, "932":80, "933":17, "934":80, "935":17, "936":28, "941":6, "942":17, "946":17, "947":2, "948":8, "949":24, "952":0, "967":17, "970":0, "978":17, "980":0, "989":17, "990":17, "1005":4, "1011":17, "1012":17, "1015":2, "1031":17, "1037":136, "1038":17, "1050":17, "1052":2, "1064":6, "1067":2, "1068":17, "1073":17, "1077":17, "1082":4, "1085":6, "1090":17, "1091":17, "1094":17, "1097":0, "1098":17, "1104":0, "1105":0, "1106":17, "1117":12, "1118":12, "1119":2, "1124":6, "1126":17, "1136":4, "1137":4, "1154":4, "1155":4, "1156":17, 
}
def zeroifempty(dictionary,key):
  if not key in dictionary.keys() or dictionary[key] == "":
    return 0
  return dictionary[key]

import_command = ""

!mkdir dumps
for char_name in dumps.keys():

  stage1 = base64.b64decode(dumps[char_name][::-1]).decode('utf-8','ignore')
  stage2 = base64.b64decode(stage1+"==").decode('utf-8','ignore')[::-1]
  #print(stage2)
  char = json.loads(stage2)


  # print(json.dumps(char['inventory'], indent=4))
  character_qry = "INSERT INTO `characters` (`guid`, `account`, `name`, `race`, `class`, `gender`, `level`, `xp`, `money`, `skin`, `face`, `hairStyle`, `hairColor`, `facialStyle`, `bankSlots`, `restState`, `playerFlags`, `position_x`, `position_y`, `position_z`, `map`, `instance_id`, `instance_mode_mask`, `orientation`, `taximask`, `online`, `cinematic`, `totaltime`, `leveltime`, `logout_time`, `is_logout_resting`, `rest_bonus`, `resettalents_cost`, `resettalents_time`, `trans_x`, `trans_y`, `trans_z`, `trans_o`, `transguid`, `extra_flags`, `stable_slots`, `at_login`, `zone`, `death_expire_time`, `taxi_path`, `arenaPoints`, `totalHonorPoints`, `todayHonorPoints`, `yesterdayHonorPoints`, `totalKills`, `todayKills`, `yesterdayKills`, `chosenTitle`, `knownCurrencies`, `watchedFaction`, `drunk`, `health`, `power1`, `power2`, `power3`, `power4`, `power5`, `power6`, `power7`, `latency`, `talentGroupsCount`, `activeTalentGroup`, `exploredZones`, `equipmentCache`, `ammoId`, `knownTitles`, `actionBars`, `grantableLevels`, `order`, `creation_date`, `deleteInfos_Account`, `deleteInfos_Name`, `deleteDate`, `innTriggerId`) VALUES ('{guid}', '{account}', '{name}', '{race}', '{pclass}', '{gender}', '{level}', '{xp}', '{money}', '{skin}', '{face}', '{hairStyle}', '{hairColor}', '{facialStyle}', '{bankSlots}', '{restState}', '{playerFlags}', '{position_x}', '{position_y}', '{position_z}', '{map}', '{instance_id}', '{instance_mode_mask}', '{orientation}', '{taximask}', '{online}', '{cinematic}', '{totaltime}', '{leveltime}', '{logout_time}', '{is_logout_resting}', '{rest_bonus}', '{resettalents_cost}', '{resettalents_time}', '{trans_x}', '{trans_y}', '{trans_z}', '{trans_o}', '{transguid}', '{extra_flags}', '{stable_slots}', '{at_login}', '{zone}', '{death_expire_time}', '{taxi_path}', '{arenaPoints}', '{totalHonorPoints}', '{todayHonorPoints}', '{yesterdayHonorPoints}', '{totalKills}', '{todayKills}', '{yesterdayKills}', '{chosenTitle}', '{knownCurrencies}', '{watchedFaction}', '{drunk}', '{health}', '{power1}', '{power2}', '{power3}', '{power4}', '{power5}', '{power6}', '{power7}', '{latency}', '{talentGroupsCount}', '{activeTalentGroup}', '{exploredZones}', '{equipmentCache}', '{ammoId}', '{knownTitles}', '{actionBars}', '{grantableLevels}', '{order}', '{creation_date}', '{deleteInfos_Account}', '{deleteInfos_Name}', '{deleteDate}', '{innTriggerId}');".format(
        guid=1,
        account=1,
        name=char_name,
        race=GetRaceID(char['uinf']['race']),
        pclass=GetClassID(char['uinf']['class']),
        gender=int(char['uinf']['gender'])-2,
        level=char['uinf']['level'],
        xp=0,
        money=1041817500, #a lot!
        skin=1,
        face=1,
        hairStyle=1,
        hairColor=1,
        facialStyle=1,
        bankSlots=0,
        restState=1,
        playerFlags=0,
        position_x=9332.39, #ulduar
        position_y=-1108.76, #ulduar
        position_z=1245.15, #ulduar
        map=571,
        instance_id=0,
        instance_mode_mask=16,
        orientation=6.27842,
        taximask="32 0 0 8 0 0 1048576 0 0 0 0 0 0 0 ",
        online=0,
        cinematic=1,
        totaltime=1,
        leveltime=1,
        logout_time=1671837829,
        is_logout_resting=0,
        rest_bonus=0,
        resettalents_cost=0,
        resettalents_time=0,
        trans_x=0,
        trans_y=0,
        trans_z=0,
        trans_o=0,
        transguid=0,
        extra_flags=64,
        stable_slots=0,
        at_login=0,
        zone=67,
        death_expire_time=1671407033,
        taxi_path="NULL",
        arenaPoints=0,
        totalHonorPoints=0,
        todayHonorPoints=0,
        yesterdayHonorPoints=0,
        totalKills=0,
        todayKills=0,
        yesterdayKills=0,
        chosenTitle=0,
        knownCurrencies=67108864,
        watchedFaction=4294967295,
        drunk=0,
        health=20000, 
        power1=20000,
        power2=0,
        power3=0,
        power4=100,
        power5=0,
        power6=0,
        power7=0,
        latency=50,
        talentGroupsCount=2,
        activeTalentGroup=0,
        exploredZones="0 0 0 0 0 0 1048576 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 32768 0 0 0 0 0 0 512 0 0 8192 33554432 0 0 0 0 0 0 8388608 32776 0 0 0 2151677952 2304 0 0 572662288 131072 0 0 0 0 67108864 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ",
        equipmentCache=GetEquipmentCache(char["inventory"]), 
        ammoId=0,                                            
        knownTitles='0 0 0 805306368 4 0 ',
        actionBars=0,
        grantableLevels=0,
        order="NULL",
        creation_date=time.strftime("%Y-%m-%d %H:%M:%S", time.localtime()),
        deleteInfos_Account="NULL",
        deleteInfos_Name="NULL",
        deleteDate="NULL",
      innTriggerId=0,
  )

  #INSERT INTO `character_glyphs` (`guid`, `talentGroup`, `glyph1`, `glyph2`, `glyph3`, `glyph4`, `glyph5`, `glyph6`) VALUES ('41', '0', '278', '478', '0', '911', '0', '760');
  glyph_qry = ""
  for talent_grp in [0,1]:
    glyph_qry += "INSERT INTO `character_glyphs` (`guid`, `talentGroup`, `glyph1`, `glyph2`, `glyph3`, `glyph4`, `glyph5`, `glyph6`) VALUES ('{guid}', '{talentGroup}', '{majorTop}', '{minorLeft}', '{minorRight}', '{majorLeft}', '{minorBot}', '{majorRight}');\n".format(
        guid=1, 
        talentGroup=talent_grp, 
        majorTop=  glyph2id[str(char["glyphs"][talent_grp][0][0])], 
        minorLeft= glyph2id[str(char["glyphs"][talent_grp][1][0])],
        minorRight=glyph2id[str(char["glyphs"][talent_grp][1][1])],
        majorLeft= glyph2id[str(char["glyphs"][talent_grp][0][1])],
        minorBot=  glyph2id[str(char["glyphs"][talent_grp][1][2])],
        majorRight=glyph2id[str(char["glyphs"][talent_grp][0][2])]
    )

  skill_qry = ""
  for skill_entry in char["skills"]:
    skill_name = skill_entry['N'].upper() 
    if skill_name in skill2id.keys():
      skill_qry += "INSERT INTO `character_skills` (`guid`, `skill`, `value`, `max`) VALUES ('{guid}', '{skill}', '{value}', '{max}');\n".format(
          guid=1,
          skill=skill2id[skill_name],
          value=skill_entry['C'],
          max=skill_entry['M']
      )


  #add mounts and pets (including TLPD)
  for spell_id in char["creature"].values():
    char["spells"][str(spell_id)] = 1 
  char["spells"]["60002"] = 1


  spell_qry = ""
  for spell_id in char["spells"].keys():
      spell_qry += "INSERT INTO `character_spell` (`guid`, `spell`, `specMask`) VALUES ('{guid}', '{spellid}', '{specmask}');\n".format(
          guid=1,
          spellid=spell_id,
          specmask=255
    )

  reputation_qry = ""      
  for reputation_id in reputation_flags.keys():
    reputation_qry += "INSERT INTO `character_reputation` (`guid`, `faction`, `standing`, `flags`) VALUES ('{guid}', '{reputation_id}', '{standing}', '{flags}');\n".format(
        guid=1,
        reputation_id=reputation_id,
        standing=42000, #exalted
        flags=reputation_flags[reputation_id]
    )


  #INSERT INTO `character_account_data` (`guid`, `type`, `time`, `data`) VALUES ('9', '7', '1671750216', 'VERSION 5\n\nADDEDVERSION 13\n\nOPTION_GUILD_RECRUITMENT_CHANNEL AUTO\n\nCHANNELS\nEND\n\nZONECHANNELS 52428803\n\nCOLORS\nSYSTEM 255 255 0 N\nSAY 255 255 255 N\nPARTY 170 170 255 N\nRAID 255 127 0 N\nGUILD 64 255 64 N\nOFFICER 64 192 64 N\nYELL 255 64 64 N\nWHISPER 255 128 255 N\nWHISPER_FOREIGN 255 128 255 N\nWHISPER_INFORM 255 128 255 N\nEMOTE 255 128 64 N\nTEXT_EMOTE 255 128 64 N\nMONSTER_SAY 255 255 159 N\nMONSTER_PARTY 170 170 255 N\nMONSTER_YELL 255 64 64 N\nMONSTER_WHISPER 255 181 235 N\nMONSTER_EMOTE 255 128 64 N\nCHANNEL 255 192 192 N\nCHANNEL_JOIN 192 128 128 N\nCHANNEL_LEAVE 192 128 128 N\nCHANNEL_LIST 192 128 128 N\nCHANNEL_NOTICE 192 192 192 N\nCHANNEL_NOTICE_USER 192 192 192 N\nAFK 255 128 255 N\nDND 255 128 255 N\nIGNORED 255 0 0 N\nSKILL 85 85 255 N\nLOOT 0 170 0 N\nMONEY 255 255 0 N\nOPENING 128 128 255 N\nTRADESKILLS 255 255 255 N\nPET_INFO 128 128 255 N\nCOMBAT_MISC_INFO 128 128 255 N\nCOMBAT_XP_GAIN 111 111 255 N\nCOMBAT_HONOR_GAIN 224 202 10 N\nCOMBAT_FACTION_CHANGE 128 128 255 N\nBG_SYSTEM_NEUTRAL 255 120 10 N\nBG_SYSTEM_ALLIANCE 0 174 239 N\nBG_SYSTEM_HORDE 255 0 0 N\nRAID_LEADER 255 72 9 N\nRAID_WARNING 255 72 0 N\nRAID_BOSS_EMOTE 255 221 0 N\nRAID_BOSS_WHISPER 255 221 0 N\nFILTERED 255 0 0 N\nBATTLEGROUND 255 127 0 N\nBATTLEGROUND_LEADER 255 219 183 N\nRESTRICTED 255 0 0 N\nBATTLENET 255 255 255 N\nACHIEVEMENT 255 255 0 N\nGUILD_ACHIEVEMENT 64 255 64 N\nARENA_POINTS 255 255 255 N\nPARTY_LEADER 118 200 255 N\nTARGETICONS 255 255 0 N\nBN_WHISPER 0 255 246 N\nBN_WHISPER_INFORM 0 255 246 N\nBN_CONVERSATION 0 177 240 N\nBN_CONVERSATION_NOTICE 0 177 240 N\nBN_CONVERSATION_LIST 0 177 240 N\nBN_INLINE_TOAST_ALERT 130 197 255 N\nBN_INLINE_TOAST_BROADCAST 130 197 255 N\nBN_INLINE_TOAST_BROADCAST_INFORM 130 197 255 N\nBN_INLINE_TOAST_CONVERSATION 130 197 255 N\nCHANNEL1 255 192 192 N\nCHANNEL2 255 192 192 N\nCHANNEL3 255 192 192 N\nCHANNEL4 255 192 192 N\nCHANNEL5 255 192 192 N\nCHANNEL6 255 192 192 N\nCHANNEL7 255 192 192 N\nCHANNEL8 255 192 192 N\nCHANNEL9 255 192 192 N\nCHANNEL10 255 192 192 N\nEND\n\nWINDOW 1\nNAME General\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 1\nSHOWN 1\nPOSITION BOTTOMLEFT 0.005586 0.033281\nDIMENSIONS 401.012634 123.139236\n\nMESSAGES\nSYSTEM\nSYSTEM_NOMENU\nSAY\nEMOTE\nYELL\nWHISPER\nPARTY\nPARTY_LEADER\nRAID\nRAID_LEADER\nRAID_WARNING\nBATTLEGROUND\nBATTLEGROUND_LEADER\nGUILD\nOFFICER\nMONSTER_SAY\nMONSTER_YELL\nMONSTER_EMOTE\nMONSTER_WHISPER\nMONSTER_BOSS_EMOTE\nMONSTER_BOSS_WHISPER\nERRORS\nAFK\nDND\nIGNORED\nBG_HORDE\nBG_ALLIANCE\nBG_NEUTRAL\nCOMBAT_FACTION_CHANGE\nSKILL\nLOOT\nMONEY\nCHANNEL\nACHIEVEMENT\nGUILD_ACHIEVEMENT\nTARGETICONS\nBN_WHISPER\nBN_WHISPER_INFORM\nBN_CONVERSATION\nBN_INLINE_TOAST_ALERT\nEND\n\nCHANNELS\nLookingForGroup\nEND\n\nZONECHANNELS 18874371\n\nEND\n\nWINDOW 2\nNAME Combat Log\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 2\nSHOWN 0\nMESSAGES\nOPENING\nTRADESKILLS\nPET_INFO\nCOMBAT_XP_GAIN\nCOMBAT_HONOR_GAIN\nCOMBAT_MISC_INFO\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 3\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.005586 0.033281\nDIMENSIONS 401.012634 123.139236\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 4\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.005586 0.033281\nDIMENSIONS 401.012634 123.139236\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 5\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.005586 0.033281\nDIMENSIONS 401.012634 123.139236\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 6\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.005586 0.033281\nDIMENSIONS 401.012634 123.139236\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 7\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.005586 0.033281\nDIMENSIONS 401.012634 123.139236\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 8\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.005586 0.033281\nDIMENSIONS 401.012634 123.139236\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 9\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.005586 0.033281\nDIMENSIONS 401.012634 123.139236\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 10\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.005586 0.033281\nDIMENSIONS 401.012634 123.139236\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\n');
  #INSERT INTO `character_homebind` (`guid`, `mapId`, `zoneId`, `posX`, `posY`, `posZ`, `posO`) VALUES ('9', '0', '1', '-6240', '331', '383', '0');
  character_guid = 9
  item_internal_id_counter = 10
  character_inventory_qry = ""
  item_instance_qry = ""

  #INSERT INTO `character_inventory` (`guid`, `bag`, `slot`, `item`) VALUES ('9', '0', '0', '1371');
  bagstr2id = {"0000":0,"1000":0,"1001":1001,"1002":1002,"1003":1003,"1004":1004}

  bag_ids = {"0000:20":1001,"0000:21":1002,"0000:22":1003,"0000:23":1004,"0000:24":1005}

  for bagstr in ["0000", "1000", "1001", "1002", "1003", "1004"]:
    for i in range(1,37):
      bagid_slotid = "{bagid}:{equip_slot}".format(bagid=bagstr,equip_slot=i)
      if bagid_slotid in char["inventory"].keys():
        slot = char["inventory"][bagid_slotid]
        item_id = slot["I"]

        #replace Dark Portal with Hearthstone!
        if str(item_id) == "184871":
          item_id = "6948"

        if bagid_slotid in bag_ids.keys():
          item_internal_id = bag_ids[bagid_slotid]
        else:
          item_internal_id = item_internal_id_counter
          item_internal_id_counter += 1

        if bagstr == "1000":
          slotid = i+23-1
        else:
          slotid = i-1

        character_inventory_qry += "INSERT INTO `character_inventory` (`guid`, `bag`, `slot`, `item`) VALUES ('{guid}', '{bag}', '{slot}', '{item}');\n".format(
            guid=character_guid,
            bag=bagstr2id[bagstr],
            slot=slotid,
            item=item_internal_id,
        )

        item_instance_qry += """INSERT INTO `item_instance` (`guid`, `itemEntry`, `owner_guid`, `creatorGuid`, `giftCreatorGuid`, `count`, `duration`, `charges`, `flags`, `enchantments`, `randomPropertyId`, `durability`, `playedTime`, `text`) VALUES ('{guid}', '{itemEntry}', '{owner_guid}', '{creatorGuid}', '{giftCreatorGuid}', '{count}', '{duration}', '{charges}', '{flags}', '{enchantments}', '{randomPropertyId}', '{durability}', '{playedTime}', '{text}');\n""".format(
          guid=item_internal_id,
          itemEntry=item_id,
          owner_guid=character_guid,
          creatorGuid=0,
          giftCreatorGuid=0,
          count=slot["C"],
          duration=0,
          charges=str(zeroifempty(slot,"CH")) + " 0 0 0 0 ",
          flags=1,
          enchantments=GetEnchantments(slot),
          randomPropertyId=0,
          durability=zeroifempty(slot,"D"),
          playedTime=0,
          text="NULL",
          )

  with open('dumps/{char_name}.pdump'.format(char_name=char_name.lower()), 'w') as writefile:
    writefile.write("IMPORTANT NOTE: THIS DUMPFILE IS MADE FOR USE WITH THE 'PDUMP' COMMAND ONLY - EITHER THROUGH INGAME CHAT OR ON CONSOLE!")
    writefile.write("IMPORTANT NOTE: DO NOT apply it directly - it will irreversibly DAMAGE and CORRUPT your database! You have been warned!\n")
    writefile.write("INSERT INTO `character_homebind` (`guid`, `mapId`, `zoneId`, `posX`, `posY`, `posZ`, `posO`) VALUES ('1', '571', '4395', '5717.39', '682.666', '645.751', '3.5123');\n")
    writefile.write(character_qry+"\n")
    writefile.write(glyph_qry+"\n")
    writefile.write(skill_qry+"\n")
    writefile.write(reputation_qry+"\n")
    writefile.write(r"INSERT INTO `character_account_data` (`guid`, `type`, `time`, `data`) VALUES ('23', '1', '1672008407', 'SET minimapInsideZoom \"0\"\nSET questLogCollapseFilter \"-1\"\nSET trackedQuests \"v\"\nSET trackedAchievements \"v\"\nSET cameraSavedDistance \"30.000000\"\nSET cameraSavedPitch \"31.800002\"\nSET showKeyring \"1\"\nSET playerStatLeftDropdown \"PLAYERSTAT_BASE_STATS\"\nSET playerStatRightDropdown \"PLAYERSTAT_SPELL_COMBAT\"\nSET showTokenFrame \"1\"\nSET ShowClassColorInNameplate \"1\"\n');" + "\n")
    writefile.write(r"INSERT INTO `character_account_data` (`guid`, `type`, `time`, `data`) VALUES ('23', '7', '1671912454', 'VERSION 5\n\nADDEDVERSION 13\n\nOPTION_GUILD_RECRUITMENT_CHANNEL AUTO\n\nCHANNELS\nEND\n\nZONECHANNELS 52428803\n\nCOLORS\nSYSTEM 255 255 0 N\nSAY 255 255 255 N\nPARTY 170 170 255 N\nRAID 255 127 0 N\nGUILD 64 255 64 N\nOFFICER 64 192 64 N\nYELL 255 64 64 N\nWHISPER 255 128 255 N\nWHISPER_FOREIGN 255 128 255 N\nWHISPER_INFORM 255 128 255 N\nEMOTE 255 128 64 N\nTEXT_EMOTE 255 128 64 N\nMONSTER_SAY 255 255 159 N\nMONSTER_PARTY 170 170 255 N\nMONSTER_YELL 255 64 64 N\nMONSTER_WHISPER 255 181 235 N\nMONSTER_EMOTE 255 128 64 N\nCHANNEL 255 192 192 N\nCHANNEL_JOIN 192 128 128 N\nCHANNEL_LEAVE 192 128 128 N\nCHANNEL_LIST 192 128 128 N\nCHANNEL_NOTICE 192 192 192 N\nCHANNEL_NOTICE_USER 192 192 192 N\nAFK 255 128 255 N\nDND 255 128 255 N\nIGNORED 255 0 0 N\nSKILL 85 85 255 N\nLOOT 0 170 0 N\nMONEY 255 255 0 N\nOPENING 128 128 255 N\nTRADESKILLS 255 255 255 N\nPET_INFO 128 128 255 N\nCOMBAT_MISC_INFO 128 128 255 N\nCOMBAT_XP_GAIN 111 111 255 N\nCOMBAT_HONOR_GAIN 224 202 10 N\nCOMBAT_FACTION_CHANGE 128 128 255 N\nBG_SYSTEM_NEUTRAL 255 120 10 N\nBG_SYSTEM_ALLIANCE 0 174 239 N\nBG_SYSTEM_HORDE 255 0 0 N\nRAID_LEADER 255 72 9 N\nRAID_WARNING 255 72 0 N\nRAID_BOSS_EMOTE 255 221 0 N\nRAID_BOSS_WHISPER 255 221 0 N\nFILTERED 255 0 0 N\nBATTLEGROUND 255 127 0 N\nBATTLEGROUND_LEADER 255 219 183 N\nRESTRICTED 255 0 0 N\nBATTLENET 255 255 255 N\nACHIEVEMENT 255 255 0 N\nGUILD_ACHIEVEMENT 64 255 64 N\nARENA_POINTS 255 255 255 N\nPARTY_LEADER 118 200 255 N\nTARGETICONS 255 255 0 N\nBN_WHISPER 0 255 246 N\nBN_WHISPER_INFORM 0 255 246 N\nBN_CONVERSATION 0 177 240 N\nBN_CONVERSATION_NOTICE 0 177 240 N\nBN_CONVERSATION_LIST 0 177 240 N\nBN_INLINE_TOAST_ALERT 130 197 255 N\nBN_INLINE_TOAST_BROADCAST 130 197 255 N\nBN_INLINE_TOAST_BROADCAST_INFORM 130 197 255 N\nBN_INLINE_TOAST_CONVERSATION 130 197 255 N\nCHANNEL1 255 192 192 N\nCHANNEL2 255 192 192 N\nCHANNEL3 255 192 192 N\nCHANNEL4 255 192 192 N\nCHANNEL5 255 192 192 N\nCHANNEL6 255 192 192 N\nCHANNEL7 255 192 192 N\nCHANNEL8 255 192 192 N\nCHANNEL9 255 192 192 N\nCHANNEL10 255 192 192 N\nEND\n\nWINDOW 1\nNAME General\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 1\nSHOWN 1\nPOSITION BOTTOMLEFT 0.006250 0.032226\nDIMENSIONS 461.000000 178.999985\n\nMESSAGES\nSYSTEM\nSYSTEM_NOMENU\nSAY\nEMOTE\nYELL\nWHISPER\nPARTY\nPARTY_LEADER\nRAID\nRAID_LEADER\nRAID_WARNING\nBATTLEGROUND\nBATTLEGROUND_LEADER\nGUILD\nOFFICER\nMONSTER_SAY\nMONSTER_YELL\nMONSTER_EMOTE\nMONSTER_WHISPER\nMONSTER_BOSS_EMOTE\nMONSTER_BOSS_WHISPER\nERRORS\nAFK\nDND\nIGNORED\nBG_HORDE\nBG_ALLIANCE\nBG_NEUTRAL\nCOMBAT_FACTION_CHANGE\nSKILL\nLOOT\nMONEY\nCHANNEL\nACHIEVEMENT\nGUILD_ACHIEVEMENT\nTARGETICONS\nBN_WHISPER\nBN_WHISPER_INFORM\nBN_CONVERSATION\nBN_INLINE_TOAST_ALERT\nEND\n\nCHANNELS\nLookingForGroup\nEND\n\nZONECHANNELS 18874371\n\nEND\n\nWINDOW 2\nNAME Combat Log\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 2\nSHOWN 0\nMESSAGES\nOPENING\nTRADESKILLS\nPET_INFO\nCOMBAT_XP_GAIN\nCOMBAT_HONOR_GAIN\nCOMBAT_MISC_INFO\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 3\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.006250 0.032226\nDIMENSIONS 461.000000 178.999985\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 4\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.006250 0.032226\nDIMENSIONS 461.000000 178.999985\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 5\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.006250 0.032226\nDIMENSIONS 461.000000 178.999985\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 6\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.006250 0.032226\nDIMENSIONS 461.000000 178.999985\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 7\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.006250 0.032226\nDIMENSIONS 461.000000 178.999985\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 8\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.006250 0.032226\nDIMENSIONS 461.000000 178.999985\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 9\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.006250 0.032226\nDIMENSIONS 461.000000 178.999985\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\nWINDOW 10\nSIZE 0\nCOLOR 0 0 0 40\nLOCKED 1\nUNINTERACTABLE 0\nDOCKED 0\nSHOWN 0\nPOSITION BOTTOMLEFT 0.006250 0.032226\nDIMENSIONS 461.000000 178.999985\n\nMESSAGES\nEND\n\nCHANNELS\nEND\n\nZONECHANNELS 0\n\nEND\n\n');" + "\n")
    writefile.write(character_inventory_qry+"\n")
    writefile.write(item_instance_qry+"\n")
    writefile.write(spell_qry+"\n") 

  import_command += ".account create {char_name} {char_name}\n.pdump load {char_name}.pdump {char_name} {char_name}\n".format(char_name=char_name.lower())

print(import_command)
!zip -r /content/dumps.zip /content/dumps/

!rm dumps/*.pdump
!rmdir dumps